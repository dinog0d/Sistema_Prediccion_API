{% extends 'base.html' %}

{% block title %}Resultado - Sistema de Predicci√≥n GRD{% endblock %}

{% block header %}Resultado de la Predicci√≥n GRD{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <h3 class="text-center">üéØ Resultado de la Predicci√≥n GRD</h3>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <h5>‚úÖ Datos procesados exitosamente</h5>
                    <p>{{ resultado }}</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6><strong>üë• Datos Demogr√°ficos</strong></h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li><strong>Grupo Edad:</strong> {{ datos.grupo_edad }}</li>
                                    <li><strong>Sexo:</strong> 
                                        {% if datos.sexo == 'M' %}
                                            Masculino
                                        {% elif datos.sexo == 'F' %}
                                            Femenino
                                        {% else %}
                                            {{ datos.sexo }}
                                        {% endif %}
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6><strong>üè® Datos de Ingreso y Alta</strong></h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li><strong>Tipo de ingreso:</strong> {{ datos.tipo_ingreso }}</li>
                                    <li><strong>Servicio Alta:</strong> {{ datos.servicio_alta }}</li>
                                    <li><strong>Situaci√≥n al alta:</strong> {{ datos.situacion_alta }}</li>
                                    <li><strong>Cuidados intensivos:</strong> 
                                        {% if datos.cuidados_intensivos == True %}
                                            S√≠
                                        {% elif datos.cuidados_intensivos == False %}
                                            No
                                        {% else %}
                                            {{ datos.cuidados_intensivos }}
                                        {% endif %}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6><strong>ü©∫ Diagn√≥stico</strong></h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li><strong>Diagn√≥stico principal:</strong> {{ datos.dx_principal }}</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6><strong>‚è∞ Estancia y UCI</strong></h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li><strong>Estancia Grupo:</strong> {{ datos.estancia_grupo }}</li>
                                    <li><strong>UCI Grupo:</strong> {{ datos.uci_grupo }}</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6><strong>‚öïÔ∏è Comorbilidades y Procedimientos</strong></h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li><strong>Comorbilidad:</strong> 
                                        {% if datos.tiene_comorbilidad == False %}
                                            Sin comorbilidad
                                        {% elif datos.tiene_comorbilidad == True %}
                                            S√≠ tiene comorbilidad
                                        {% else %}
                                            {{ datos.tiene_comorbilidad }}
                                        {% endif %}
                                    </li>
                                    <li><strong>Procedimiento:</strong> 
                                        {% if datos.tiene_procedimiento == False %}
                                            Sin procedimiento
                                        {% elif datos.tiene_procedimiento == True %}
                                            S√≠ tiene procedimiento
                                        {% else %}
                                            {{ datos.tiene_procedimiento }}
                                        {% endif %}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                

                
                <!-- Resumen de todos los datos -->
                <div class="mt-4">
                    <details class="mb-3">
                        <summary class="btn btn-outline-secondary">üìã Ver resumen completo de datos</summary>
                        <div class="mt-3 p-3 border rounded">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Datos enviados:</h6>
                                    <ul class="small">
                                        <li>Grupo Edad: {{ datos.grupo_edad }}</li>
                                        <li>Sexo: {{ datos.sexo }}</li>
                                        <li>Tipo de ingreso: {{ datos.tipo_ingreso }}</li>
                                        <li>Servicio Alta: {{ datos.servicio_alta }}</li>
                                        <li>Cuidados intensivos: {{ datos.cuidados_intensivos }}</li>
                                        <li>Situaci√≥n al alta: {{ datos.situacion_alta }}</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>Datos cl√≠nicos:</h6>
                                    <ul class="small">
                                        <li>Diagn√≥stico principal: {{ datos.dx_principal }}</li>
                                        <li>Estancia Grupo: {{ datos.estancia_grupo }}</li>
                                        <li>UCI Grupo: {{ datos.uci_grupo }}</li>
                                        <li>Comorbilidad: {{ datos.tiene_comorbilidad }}</li>
                                        <li>Procedimiento: {{ datos.tiene_procedimiento }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
                
                <div class="alert alert-info mt-3">
                    <h6>üîÆ Predicci√≥n del C√≥digo GRD:</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-1"><strong>C√≥digo GRD estimado:</strong> 
                                {% if prediccion.error %}
                                    <span class="badge bg-danger fs-6">{{ prediccion.error }}</span>
                                {% else %}
                                    <span class="badge bg-primary fs-6">{{ prediccion.codigo_grd }}</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1"><strong>Confianza:</strong> 
                                {% if prediccion.error %}
                                    <span class="badge bg-secondary fs-6">N/A</span>
                                {% else %}
                                    <span class="badge bg-success fs-6">{{ prediccion.confianza }}%</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    
                    {% if not prediccion.error %}
                    <div class="mt-3">
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar" 
                                 style="width: {{ prediccion.confianza }}%" 
                                 aria-valuenow="{{ prediccion.confianza }}" 
                                 aria-valuemin="0" aria-valuemax="100">
                                {{ prediccion.confianza }}% de confianza
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}